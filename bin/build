#!/bin/bash

set -e

echo -e "\nGenerating Binary..."

ROOT_DIR=$(cd $(dirname $(dirname $0)) && pwd)

$ROOT_DIR/bin/generate-language-resources

windows() { [[ -n "$WINDIR" ]]; }
if windows; then
        output=`echo $ROOT_DIR/out/cf.exe | sed -e 's/^\///' -e 's/^./\0:/'`
        echo Building ${output//\//\\}...
        go build -o $ROOT_DIR/out/cf.exe ./main
else
        CLI_GOPATH=$ROOT_DIR/tmp/cli_gopath
        rm -rf $CLI_GOPATH
        mkdir -p $CLI_GOPATH/src/github.com/cloudfoundry/
        ln -s $ROOT_DIR $CLI_GOPATH/src/github.com/cloudfoundry/cli

        GODEP_GOPATH=$ROOT_DIR/Godeps/_workspace

        GOPATH=$CLI_GOPATH:$GODEP_GOPATH:$GOPATH go build -o $ROOT_DIR/out/cf ./main
        rm -rf $CLI_GOPATH
fi
